(this["webpackJsonparea-def-tool"]=this["webpackJsonparea-def-tool"]||[]).push([[0],{47:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){},51:function(e,t,n){},56:function(e,t,n){},57:function(e,t,n){},58:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),c=n(12),a=n.n(c),o=(n(47),n(7)),u=n(3),l=(n(48),n(49),n(1));function s(e){var t=e.source,n=e.setVideo,i=e.setSlider,c=(e.value,Object(r.useRef)(null));Object(r.useEffect)((function(){if(c.current&&t){c.current.src=t,n(c.current);!function e(){setTimeout((function(){var t;(null===(t=c.current)||void 0===t?void 0:t.duration)?a(1):e()}),10)}()}}),[t]);var a=function(e){if(c.current&&t&&e){var n=e<1?1:e>100?100:e;c.current.currentTime=n/100*c.current.duration,i(n)}};return Object(l.jsxs)("div",{className:"VideoCanvas",children:[Object(l.jsx)("input",{className:"slider",type:"range",min:"1",max:"100",onChange:function(e){a(+e.target.value)}}),Object(l.jsx)("video",{ref:c,hidden:!0})]})}var d=n(85);n(51);var f=function(e){var t=e.setFile,n=e.accept_types,i=void 0===n?"":n,c=Object(r.useRef)(null);return Object(l.jsxs)("div",{className:"FilePicker",children:[Object(l.jsx)(d.a,{variant:"contained",color:"primary",onClick:function(){var e;return null===(e=c.current)||void 0===e?void 0:e.click()},children:"Select Video"}),Object(l.jsx)("input",{hidden:!0,ref:c,type:"file",accept:i,onChange:function(e){var n,r,i;return t(null!==(n=null===(r=c.current)||void 0===r||null===(i=r.files)||void 0===i?void 0:i.item(0))&&void 0!==n?n:null)}})]})},j=n(36),h=n(37);function v(e,t){for(var n=!1,r=0;r<t.length;r++){var i=[t[r],t[(r+1)%t.length]];(i[0][1]<=e[1]&&i[1][1]>=e[1]||i[1][1]<=e[1]&&i[0][1]>=e[1])&&e[0]<(i[0][0]-i[1][0])*(e[1]-i[1][1])/(i[0][1]-i[1][1])+i[1][0]&&(n=!n)}return n}function b(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1])}function p(e,t){var n=g(t[1],t[0]),r=b(t[0],t[1]),i=y(n,1/r),c=O(g(e,t[0]),i);return c<0||c>r?null:x(t[0],y(i,c))}function O(e,t){return e[0]*t[0]+e[1]*t[1]}function x(e,t){return[e[0]+t[0],e[1]+t[1]]}function g(e,t){return x(e,[-(n=t)[0],-n[1]]);var n}function y(e,t){return[e[0]*t,e[1]*t]}var k,m=function(){function e(t,n){Object(j.a)(this,e),this.id=void 0,this.shape=void 0,this.isCarWalkable=!0,this.direction=null,this.isParking=!1,this.stop=null,this.isSelected=!1,this.id=e.newId(),this.shape=null!==t&&void 0!==t?t:[[-1,-1],[-1,-1],[-1,-1],[-1,-1]],n&&(this.direction=n)}return Object(h.a)(e,[{key:"toAreaDictionary",value:function(){var e,t,n=function(e){for(var t=Object(o.a)(e).sort((function(e,t){return e[1]<t[1]?-1:1})).slice(0,2).sort((function(e,t){return e[0]<t[0]?-1:1}))[0],n=e.findIndex((function(e){return e===t})),r=[],i=0;i<e.length;i++)r.push(e[(n+i)%e.length]);return r}(this.shape),r=null!==(e=this.direction)&&void 0!==e?e:[0,0];return{id:this.id,points:{lu:n[0].map((function(e){return Math.round(e)})),ru:n[1].map((function(e){return Math.round(e)})),rb:n[2].map((function(e){return Math.round(e)})),lb:n[3].map((function(e){return Math.round(e)}))},carWalk:this.isCarWalkable,dir:{left:O(r,[-1,0])>.25,up:O(r,[0,-1])>.25,right:O(r,[1,0])>.25,down:O(r,[0,1])>.25},parking:this.isParking,stop:"".concat(null!==(t=this.stop)&&void 0!==t?t:"None"),ref:this}}},{key:"fromAreaDictionary",value:function(e){this.shape=Object.values(e.points),this.isCarWalkable=e.carWalk;var t={left:[-1,0],right:[1,0],up:[0,-1],down:[0,1]};return this.direction=Object.entries(e.dir).map((function(e){var n=Object(u.a)(e,2),r=n[0];return n[1]?t[r]:[0,0]})).reduce((function(e,t){return x(e,t)})),this.isParking=e.parking,this.stop=e.stop,e.ref=this,this}}],[{key:"newId",value:function(){return e.counter++}}]),e}();m.counter=0,function(e){e[e.ADD=0]="ADD",e[e.SELECT=1]="SELECT"}(k||(k={}));n(56);function S(e){var t=e.value,n=e.onSelect,r=e.onAdd;return Object(l.jsxs)("div",{className:"ToolSelector",children:[Object(l.jsx)(d.a,{variant:t===k.ADD?"contained":"outlined",color:"secondary",onClick:r,children:"ADD"}),Object(l.jsx)(d.a,{variant:t===k.SELECT?"contained":"outlined",color:"secondary",onClick:n,children:"SELECT"})]})}var w=n(26),C=(n(57),.25),D={width:2,stroke:"rgb(250, 50, 50)",fill:"rgba(250, 50, 50, ".concat(C,")"),selected:{width:2,stroke:"rgb(255, 200, 50)",fill:"rgba(255, 200, 50, ".concat(C,")")}},A={width:2,stroke:"rgb(50, 50, 250)",fill:"rgba(50, 50, 250, ".concat(C,")"),selected:{width:2,stroke:"rgb(50, 250, 250)",fill:"rgba(50, 250, 250, ".concat(C,")")}};function E(e){var t=e.img,n=e.quads,i=e.newQuad,c=e.tool,a=e.setSelected,s=e.updateQuads,d=e.deleteQuads,f=e.slider,j=e.width,h=e.height,O=Object(r.useState)([]),g=Object(u.a)(O,2),y=g[0],S=g[1],C=Object(r.useState)(!1),E=Object(u.a)(C,2),L=E[0],N=E[1],W=Object(r.useState)(null),M=Object(u.a)(W,2),R=M[0],T=M[1],P=Object(r.useState)(null),I=Object(u.a)(P,2),U=I[0],B=I[1],X=Object(r.useRef)(null),Y=Object(r.useState)({x:0,y:0}),F=Object(u.a)(Y,2),Q=F[0],V=F[1];Object(r.useEffect)((function(){var e=X.current,r=null===e||void 0===e?void 0:e.getContext("2d");if(e&&r){try{if(!t)throw Error;r.drawImage(t,0,0,e.width,e.height)}catch(f){r.fillStyle="#fff",r.fillRect(0,0,e.width,e.height)}var i=[0,0];L&&R&&(i=[Q.x-R[0],Q.y-R[1]]);var a,u=Object(w.a)(n);try{var l=function(){var e=a.value,t=void 0;t=e.isCarWalkable?D:A,e.isSelected&&(t=t.selected),r.lineWidth=t.width,r.strokeStyle=t.stroke,r.fillStyle=t.fill,e.isSelected?q(r,e.shape.map((function(t,r){return!U||U.some((function(e){return e===r}))?_(x(t,i),n.filter((function(t){return t.id!==e.id})).map((function(e){return e.shape}))):t})),!0):q(r,e.shape)};for(u.s();!(a=u.n()).done;)l()}catch(j){u.e(j)}finally{u.f()}if(Q.x&&Q.y&&y&&c===k.ADD){var s=!1,d=[_([Q.x,Q.y],n.map((function(e){return e.shape})))].concat(Object(o.a)(y));3===y.length&&(s=!0),r.lineWidth=D.width,r.strokeStyle=D.stroke,r.fillStyle=D.fill,q(r,d,!0,s)}}}),[t,n,c,Q,y,f,j]);var _=function(e,t){var n=t.flat().reduce((function(t,n){var r=Object(u.a)(t,2),i=r[0],c=r[1],a=b(e,n);return a<i||-1===i?[a,n]:[i,c]}),[-1,null]),r=Object(u.a)(n,2),i=r[0],c=r[1];if(c&&i<25)e=c;else{var a=t.reduce((function(t,n){var r=Object(u.a)(t,2),i=r[0],c=r[1],a=n.reduce((function(t,n,r,i){var c,a=Object(u.a)(t,2),o=a[0],l=a[1],s=i[(r+1)%i.length],d=p(e,[n,s]);return d&&((c=b(e,d))<o||-1===o)?[c,d]:[o,l]}),[-1,null]),o=Object(u.a)(a,2),l=o[0],s=o[1];return l<i||-1===i?[l,s]:[i,c]}),[-1,null]),o=Object(u.a)(a,2);i=o[0],(c=o[1])&&i<25&&(e=c)}return e},q=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t[0]&&e.moveTo(t[0][0],t[0][1]),e.beginPath();var i,c=Object(w.a)(t);try{for(c.s();!(i=c.n()).done;){var a=i.value;e.lineTo(a[0],a[1])}}catch(s){c.e(s)}finally{c.f()}if(r&&e.closePath(),e.stroke(),e.fill(),n){var o,u=Object(w.a)(t);try{for(u.s();!(o=u.n()).done;){var l=o.value;J(e,l)}}catch(s){u.e(s)}finally{u.f()}}},J=function(e,t){var n=e.fillStyle,r=e.strokeStyle;e.fillStyle="#5f5",e.strokeStyle="#000",e.beginPath(),e.arc(t[0],t[1],5,0,6.3),e.closePath(),e.fill(),e.stroke(),e.fillStyle=n,e.strokeStyle=r},H=function(){var e=n.find((function(e){return e.isSelected})),t=null;if(e){var r,i=e.shape;t=[-1];var c=i.reduce((function(e,t,n){var r=Object(u.a)(e,2),i=r[0],c=r[1],a=b([Q.x,Q.y],t);return a<i?[a,n]:[i,c]}),[999,-1]),o=Object(u.a)(c,2);if(r=o[0],t[0]=o[1],r>25){var l=i.reduce((function(e,t,n,r){var i=Object(u.a)(e,2),c=i[0],a=i[1],o=(n+1)%r.length,l=r[o],s=p([Q.x,Q.y],[t,l]);if(!s)return[c,a];var d=b([Q.x,Q.y],s);return d<c?[d,[n,o]]:[c,a]}),[999,[-1]]),s=Object(u.a)(l,2);r=s[0],t=s[1]}r>25&&(t=v([Q.x,Q.y],e.shape)?[0,1,2,3]:null)}if(t)B(t),N(!0),T([Q.x,Q.y]);else{var d=function(e,t){for(var n=0;n<t.length;n++)if(v(e,t[n]))return n;return-1}([Q.x,Q.y],n.map((function(e){return e.shape})));a(d)}};return Object(l.jsx)("div",{className:"Canvas",children:Object(l.jsx)("canvas",{ref:X,onMouseDown:function(){switch(c){case k.ADD:!function(){if(Q.x&&Q.y){var e=[Q.x,Q.y],t=[e=_(e,n.map((function(e){return e.shape})))].concat(Object(o.a)(y));if(4===t.length){var r=new m(t);r.isSelected=!0,a(-1),i(r),S([])}else S(t)}}();break;case k.SELECT:H();break;default:throw Error("No tool selected???")}},onMouseUp:function(){if(L&&R){var e=n.filter((function(e){return e.isSelected})),t=[Q.x-R[0],Q.y-R[1]],r=e.map((function(e){return e.shape=e.shape.map((function(r,i){return U&&U.some((function(e){return e===i}))?_(x(r,t),n.filter((function(t){return t.id!==e.id})).map((function(e){return e.shape}))):r})),e}));s(r),N(!1),B(null),T(null)}},onMouseLeave:function(){S([]),L&&4===(null===U||void 0===U?void 0:U.length)&&(N(!1),T(null),d(n.filter((function(e){return e.isSelected}))))},onMouseMove:function(e){return function(e){var t=X.current;if(t){var n=t.clientWidth/t.width,r=[t.offsetLeft,t.offsetTop];V({x:(e.pageX-r[0])/n,y:(e.pageY-r[1])/n})}}(e)},width:null!==j&&void 0!==j?j:1920,height:null!==h&&void 0!==h?h:1080})})}var L=n(81),N=n(82);n(58);function W(e){var t=e.target,n=e.update,i=e.selectById,c=Object(r.useState)(),a=Object(u.a)(c,2),s=a[0],f=a[1],j=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.changed=t,s){var n=null===s||void 0===s?void 0:s.filter((function(t){return t.id!==e.id}));f([e].concat(Object(o.a)(n)).sort((function(e,t){return e.id<t.id?-1:1})))}};function h(e){var r,c,a=Object.entries(e.points).flatMap((function(t){var n,r,i=Object(u.a)(t,2),c=i[0],a=i[1];return n=c,r=e,a.map((function(e,t){return Object(l.jsx)("td",{children:Object(l.jsx)("input",{type:"number",value:Math.round(e),onChange:function(e){r.points[n][t]=+e.target.value,j(r)}})},"".concat(n).concat(t))}))})),o=Object.entries(e.dir).map((function(t){var n=Object(u.a)(t,2),r=n[0],i=n[1];return Object(l.jsx)("td",{children:Object(l.jsx)("input",{type:"checkbox",checked:i,onChange:function(){e.dir[r]=!e.dir[r],j(e)}})},r)}));return Object(l.jsxs)("tr",{onClick:function(){return i(e.id)},className:(null===(r=e.ref)||void 0===r?void 0:r.isSelected)?"selected":"",children:[a,Object(l.jsx)("td",{children:Object(l.jsx)("input",{type:"checkbox",checked:e.carWalk,onChange:function(){e.carWalk=!e.carWalk,j(e)}})},"iscarwalkable"),o,Object(l.jsx)("td",{children:Object(l.jsx)("input",{type:"checkbox",checked:e.parking,onChange:function(){e.parking=!e.parking,j(e)}})},"isparking"),Object(l.jsx)("td",{children:Object(l.jsx)("input",{type:"text",value:null!==(c=e.stop)&&void 0!==c?c:"None",onChange:function(t){e.stop=t.target.value,j(e)}})},"isstop"),Object(l.jsx)("td",{className:e.changed?"space":"hide"}),Object(l.jsx)("td",{className:e.changed?"":"hide",children:Object(l.jsx)(d.a,{variant:"contained",color:"primary",onClick:function(){j(e,!1),n([t.find((function(t){return t.id===e.id})).fromAreaDictionary(e)])},children:Object(l.jsx)(L.a,{})})},"update"),Object(l.jsx)("td",{className:e.changed?"":"hide",children:Object(l.jsx)(d.a,{variant:"contained",color:"secondary",className:e.changed?"":"hide",onClick:function(){e=t.find((function(t){return t.id===e.id})).toAreaDictionary(),j(e,!1)},children:Object(l.jsx)(N.a,{})})},"discard")]},e.id)}return Object(r.useEffect)((function(){var e=t.map((function(e){return e.toAreaDictionary()})),n=null===s||void 0===s?void 0:s.filter((function(e){return e.changed}));e=(e=e.map((function(e){var t=null===n||void 0===n?void 0:n.find((function(t){return t.id===e.id}));return t||e}))).sort((function(e,t){return e.id<t.id?-1:1})),f(e)}),[t]),Object(l.jsx)("div",{className:"Inspector",children:Object(l.jsxs)("table",{children:[Object(l.jsx)("thead",{children:Object(l.jsxs)("tr",{children:[Object(l.jsx)("th",{children:"luX     "}),Object(l.jsx)("th",{children:"luY     "}),Object(l.jsx)("th",{children:"ruX     "}),Object(l.jsx)("th",{children:"ruY     "}),Object(l.jsx)("th",{children:"rbX     "}),Object(l.jsx)("th",{children:"rbY     "}),Object(l.jsx)("th",{children:"lbX     "}),Object(l.jsx)("th",{children:"lbY     "}),Object(l.jsx)("th",{children:"CarWalk "}),Object(l.jsx)("th",{children:"Left    "}),Object(l.jsx)("th",{children:"Up      "}),Object(l.jsx)("th",{children:"Right   "}),Object(l.jsx)("th",{children:"Down    "}),Object(l.jsx)("th",{children:"Parking "}),Object(l.jsx)("th",{children:"Stop    "})]})}),Object(l.jsx)("tbody",{children:null===s||void 0===s?void 0:s.map((function(e){return h(e)}))})]})})}var M=n(29),R=n.n(M),T=n(38),P=(n(60),["luX","luY","ruX","ruY","rbX","rbY","lbX","lbY","CarWalk","Left","Up","Right","Down","Parking","Stop"]);function I(e){var t=e.target,n=e.source,i=e.load,c=Object(r.useRef)(null),a=Object(r.useRef)(null),o=n?n.replace(".mp4","_areas.csv"):"areas.csv",u=function(e){var t=e.map(s);return[P.join(",")].concat(t).join("\n")},s=function(e){var t=e.toAreaDictionary(),n=[t.points.lu,t.points.ru,t.points.rb,t.points.lb].map((function(e){return e.join(",")})).join(","),r=t.carWalk?1:0,i=t.parking?1:0,c=t.stop;return[n,r,[t.dir.left,t.dir.up,t.dir.right,t.dir.down].map((function(e){return e?1:0})).join(","),i,c].join(",")},f=function(){var e=Object(T.a)(R.a.mark((function e(t){var n,r,c,a,o;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return console.error("Unable to load file!"),e.abrupt("return");case 3:return e.next=5,t.text();case 5:n=e.sent,r=n.split("\n").filter((function(e){return""!==e})),c=r.slice(1).map((function(e){return e.split(",")})),a=c.map((function(e){var t={points:{},dir:{}},n=e.map((function(e){return+e}));return t.points.lu=n.slice(0,2),t.points.ru=n.slice(2,4),t.points.rb=n.slice(4,6),t.points.lb=n.slice(6,8),t.carWalk=n[8]>0,t.dir.left=n[9]>0,t.dir.up=n[10]>0,t.dir.right=n[11]>0,t.dir.down=n[12]>0,t.parking=n[13]>0,t.stop=e[14],t})),o=a.map((function(e){return(new m).fromAreaDictionary(e)})),i(o);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(l.jsxs)("div",{className:"IOManager",children:[Object(l.jsx)(d.a,{variant:"contained",color:"primary",onClick:function(){var e;return null===(e=a.current)||void 0===e?void 0:e.click()},children:"Load CSV"}),Object(l.jsx)("input",{hidden:!0,type:"file",ref:a,accept:".csv",onChange:function(){var e,t,n;return f(null!==(e=null===(t=a.current)||void 0===t||null===(n=t.files)||void 0===n?void 0:n.item(0))&&void 0!==e?e:null)}}),Object(l.jsx)(d.a,{variant:"contained",color:"primary",onClick:function(){var e,n,r=u(t),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(i);null===(e=c.current)||void 0===e||e.setAttribute("href",a),null===(n=c.current)||void 0===n||n.click(),URL.revokeObjectURL(a)},children:"Download"}),Object(l.jsx)("a",{ref:c,download:o,hidden:!0})]})}function U(){var e=Object(r.useState)(null),t=Object(u.a)(e,2),n=t[0],i=t[1],c=Object(r.useState)(""),a=Object(u.a)(c,2),d=a[0],j=a[1],h=Object(r.useState)(null),v=Object(u.a)(h,2),b=v[0],p=v[1],O=Object(r.useState)(),x=Object(u.a)(O,2),g=x[0],y=x[1],m=Object(r.useState)([]),w=Object(u.a)(m,2),C=w[0],D=w[1],A=Object(r.useState)(k.ADD),L=Object(u.a)(A,2),N=L[0],M=L[1];Object(r.useEffect)((function(){if(n){var e=URL.createObjectURL(n);j(e)}}),[n]);var R=function(e){C.map((function(e){return e.isSelected=!1})),e>=0&&e<C.length&&(C[e].isSelected=!0),D(Object(o.a)(C))},T=function(e){var t=C.filter((function(t){return e.every((function(e){return e.id!==t.id}))}));D([].concat(Object(o.a)(e),Object(o.a)(t)))};return Object(l.jsxs)("div",{className:"App",children:[Object(l.jsxs)("div",{children:[Object(l.jsxs)("div",{className:"BlockCanvas",children:[Object(l.jsx)(E,{img:b,quads:C,newQuad:function(e){return D([e].concat(Object(o.a)(C)))},tool:N,setSelected:R,updateQuads:T,deleteQuads:function(e){var t=C.filter((function(t){return e.every((function(e){return e.id!==t.id}))}));D(t)},slider:g,width:(null===b||void 0===b?void 0:b.videoWidth)||void 0,height:(null===b||void 0===b?void 0:b.videoHeight)||void 0}),Object(l.jsx)(s,{source:d,setVideo:p,setSlider:y,value:null!==g&&void 0!==g?g:0})]}),Object(l.jsxs)("div",{className:"BlockButtons",children:[Object(l.jsx)(S,{value:N,onAdd:function(){M(k.ADD),R(-1)},onSelect:function(){M(k.SELECT),R(-1)}}),Object(l.jsx)(f,{setFile:i,accept_types:"video/*"}),Object(l.jsx)(I,{target:C,source:null===n||void 0===n?void 0:n.name,load:function(e){return D(e)}})]})]}),Object(l.jsx)("div",{children:Object(l.jsx)(W,{target:C,update:T,selectById:function(e){R(C.findIndex((function(t){return t.id===e})))}})})]})}var B=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,86)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,c=t.getLCP,a=t.getTTFB;n(e),r(e),i(e),c(e),a(e)}))},X=n(39),Y=n(83),F=n(84),Q=n(25),V=n(24),_=Object(X.a)({palette:{type:"dark",primary:{main:Q.a[400]},secondary:{main:V.a[400]}},typography:{button:{fontWeight:"bold"}},overrides:{MuiButton:{outlined:{border:"2px solid !important"}}}});a.a.render(Object(l.jsx)(i.a.StrictMode,{children:Object(l.jsxs)(Y.a,{theme:_,children:[Object(l.jsx)(F.a,{}),Object(l.jsx)(U,{})]})}),document.getElementById("root")),B()}},[[61,1,2]]]);
//# sourceMappingURL=main.733e1be0.chunk.js.map