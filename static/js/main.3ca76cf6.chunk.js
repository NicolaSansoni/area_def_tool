(this["webpackJsonparea-def-tool"]=this["webpackJsonparea-def-tool"]||[]).push([[0],[,,,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var c=n(1),i=n.n(c),r=n(8),a=n.n(r),u=(n(16),n(3)),o=n(4),l=n(2),s=(n(17),n(18),n(0));function d(e){var t=e.source,n=e.setVideo,i=e.setSlider,r=e.value,a=Object(c.useRef)(null);Object(c.useEffect)((function(){if(a.current&&t){a.current.src=t,n(a.current);!function e(){setTimeout((function(){var t;(null===(t=a.current)||void 0===t?void 0:t.duration)?u(1):e()}),10)}()}}),[t]);var u=function(e){if(a.current&&t&&e){var n=e<1?1:e>100?100:e;a.current.currentTime=n/100*a.current.duration,i(n)}};return Object(s.jsxs)("div",{className:"VideoCanvas",children:[Object(s.jsx)("input",{className:"slider",type:"range",min:"1",max:"100",value:r,onChange:function(e){u(+e.target.value)}}),Object(s.jsx)("video",{ref:a,hidden:!0})]})}n(20);var j=function(e){var t=e.setFile,n=e.accept_types,i=void 0===n?"":n,r=Object(c.useRef)(null);return Object(s.jsxs)("div",{className:"FilePicker",children:[Object(s.jsx)("button",{onClick:function(){var e;return null===(e=r.current)||void 0===e?void 0:e.click()},children:"Select Video"}),Object(s.jsx)("input",{hidden:!0,ref:r,type:"file",accept:i,onChange:function(e){var n,c,i;return t(null!==(n=null===(c=r.current)||void 0===c||null===(i=c.files)||void 0===i?void 0:i.item(0))&&void 0!==n?n:null)}})]})},f=n(9),h=n(10);function b(e){var t=e.sort((function(e,t){return e[1]<t[1]?-1:1}));if(t[0][0]>t[1][0]){var n=t[0];t[0]=t[1],t[1]=n}if(t[2][0]<t[3][0]){var c=t[2];t[2]=t[3],t[3]=c}return t}function v(e,t){for(var n=!1,c=0;c<t.length;c++){var i=[t[c],t[(c+1)%t.length]];(i[0][1]<=e[1]&&i[1][1]>=e[1]||i[1][1]<=e[1]&&i[0][1]>=e[1])&&e[0]<(i[0][0]-i[1][0])*(e[1]-i[1][1])/(i[0][1]-i[1][1])+i[1][0]&&(n=!n)}return n}function O(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1])}function p(e,t){return e[0]*t[0]+e[1]*t[1]}function x(e,t){return[e[0]+t[0],e[1]+t[1]]}function g(e,t){return x(e,[-(n=t)[0],-n[1]]);var n}function k(e,t){return[e[0]*t,e[1]*t]}var m,y=function(){function e(t,n){Object(f.a)(this,e),this.id=void 0,this.shape=void 0,this.isCarWalkable=!0,this.direction=null,this.isParking=!1,this.stop=null,this.isSelected=!1,this.id=e.newId(),this.shape=t,n&&(this.direction=n)}return Object(h.a)(e,[{key:"toAreaDictionary",value:function(){var e,t,n=b(this.shape),c=null!==(e=this.direction)&&void 0!==e?e:[0,0];return{id:this.id,points:{lu:Object(u.a)(n[0]),ru:Object(u.a)(n[1]),rb:Object(u.a)(n[2]),lb:Object(u.a)(n[3])},carWalk:this.isCarWalkable,dir:{left:p(c,[-1,0])>.25,up:p(c,[0,-1])>.25,right:p(c,[1,0])>.25,down:p(c,[0,1])>.25},parking:this.isParking,stop:"".concat(null!==(t=this.stop)&&void 0!==t?t:"None")}}},{key:"fromAreaDictionary",value:function(e){this.shape=Object.values(e.points),this.isCarWalkable=e.carWalk;var t={left:[-1,0],right:[1,0],up:[0,-1],down:[0,1]};return this.direction=Object.entries(e.dir).map((function(e){var n=Object(l.a)(e,2),c=n[0];return n[1]?t[c]:[0,0]})).reduce((function(e,t){return x(e,t)})),this.isParking=e.parking,this.stop=e.stop,this}}],[{key:"newId",value:function(){return e.counter++}}]),e}();y.counter=0,function(e){e[e.ADD=0]="ADD",e[e.SELECT=1]="SELECT"}(m||(m={}));n(21);function S(e){var t=e.value,n=e.onSelect,c=e.onAdd;return Object(s.jsxs)("div",{className:"ToolSelector",children:[Object(s.jsx)("button",{className:t===m.ADD?"active":"",onClick:c,children:"ADD"}),Object(s.jsx)("button",{className:t===m.SELECT?"active":"",onClick:n,children:"SELECT"})]})}var C=n(11);n(22);function D(e){var t=e.img,n=e.quads,i=e.newQuad,r=e.tool,a=e.setSelected,d=e.moveSelected,j=e.deleteSelected,f=e.slider,h=e.width,b=e.height,S=Object(c.useState)([]),D=Object(l.a)(S,2),w=D[0],E=D[1],N=Object(c.useState)(!1),A=Object(l.a)(N,2),L=A[0],W=A[1],R=Object(c.useState)(null),T=Object(l.a)(R,2),P=T[0],M=T[1],U=Object(c.useRef)(null),X=Object(C.a)(U),Y={x:null,y:null};Object(c.useEffect)((function(){var e=U.current,c=null===e||void 0===e?void 0:e.getContext("2d");if(e&&c){var i=e.clientWidth/e.width;Y.x=X.x?X.x/i:null,Y.y=X.y?X.y/i:null,t?c.drawImage(t,0,0,e.width,e.height):(c.fillStyle="#fff",c.fillRect(0,0,e.width,e.height));var a=[0,0];L&&P&&(a=[Y.x-P[0],Y.y-P[1]]);var l,s=Object(o.a)(n);try{for(s.s();!(l=s.n()).done;){var d=l.value;d.isSelected?(c.strokeStyle="#ff0",c.fillStyle="#0ff",I(c,d.shape.map((function(e){return x(e,a)})),!0)):(c.strokeStyle="#f00",c.fillStyle="#00f",I(c,d.shape,!0))}}catch(h){s.e(h)}finally{s.f()}if(Y.x&&Y.y&&w&&r===m.ADD){var j=!1,f=[F([Y.x,Y.y],n.map((function(e){return e.shape})))].concat(Object(u.a)(w));3===w.length&&(j=!0),c.strokeStyle="#f00",c.fillStyle="#00f",I(c,f,!0,j)}}}),[t,n,r,X,w,f,h]);var F=function(e,t){var n=t.reduce((function(t,n){var c=Object(l.a)(t,2),i=c[0],r=c[1],a=n.reduce((function(t,n,c,i){var r,a,o=Object(l.a)(t,2),s=o[0],d=o[1],j=i[(c+1)%i.length],f=function(e,t){var n=g(t[1],t[0]),c=O(t[0],t[1]),i=k(n,1/c),r=p(g(e,t[0]),i);return r<0||r>c?null:x(t[0],k(i,r))}(e,[n,j]);if(f)r=O(e,f),a=f;else{var h=O(e,n),b=O(e,j),v=h<b?[h,Object(u.a)(n)]:[b,Object(u.a)(j)],m=Object(l.a)(v,2);r=m[0],a=m[1]}return r<s||-1===s?[r,a]:[s,d]}),[-1,null]),o=Object(l.a)(a,2),s=o[0],d=o[1];return s<i||-1===i?[s,d]:[i,r]}),[-1,null]),c=Object(l.a)(n,2),i=c[0],r=c[1];return r&&i<50&&(e=r),e},I=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t[0]&&e.moveTo(t[0][0],t[0][1]),e.beginPath();var i,r=Object(o.a)(t);try{for(r.s();!(i=r.n()).done;){var a=i.value;e.lineTo(a[0],a[1])}}catch(d){r.e(d)}finally{r.f()}if(c&&e.closePath(),e.stroke(),n){var u,l=Object(o.a)(t);try{for(l.s();!(u=l.n()).done;){var s=u.value;B(e,s)}}catch(d){l.e(d)}finally{l.f()}}},B=function(e,t){e.beginPath(),e.arc(t[0],t[1],5,0,6.3),e.closePath(),e.fill()},V=function(){var e=function(e,t){for(var n=0;n<t.length;n++)if(v(e,t[n]))return n;return-1}([Y.x,Y.y],n.map((function(e){return e.shape})));e>=0&&n[e].isSelected?(W(!0),M([Y.x,Y.y])):a(e)};return Object(s.jsx)("div",{className:"Canvas",children:Object(s.jsx)("canvas",{ref:U,onMouseDown:function(){switch(r){case m.ADD:!function(){if(Y.x&&Y.y){var e=[Y.x,Y.y],t=[e=F(e,n.map((function(e){return e.shape})))].concat(Object(u.a)(w));if(4===t.length){var c=new y(t);c.isSelected=!0,a(-1),i(c),E([])}else E(t)}}();break;case m.SELECT:V();break;default:throw Error("No tool selected???")}},onMouseUp:function(){L&&P&&(d([Y.x-P[0],Y.y-P[1]]),W(!1),M(null))},onMouseLeave:function(){E([]),L&&(W(!1),M(null),j())},width:null!==h&&void 0!==h?h:1280,height:null!==b&&void 0!==b?b:720})})}n(23);function w(e){var t=e.target,n=e.update,i=Object(c.useState)(),r=Object(l.a)(i,2),a=r[0],o=r[1],d=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.changed=t,a){var n=null===a||void 0===a?void 0:a.filter((function(t){return t.id!==e.id}));o([e].concat(Object(u.a)(n)).sort((function(e,t){return e.id<t.id?-1:1})))}};function j(e){var c,i=Object.entries(e.points).flatMap((function(t){var n,c,i=Object(l.a)(t,2),r=i[0],a=i[1];return n=r,c=e,a.map((function(e,t){return Object(s.jsx)("td",{children:Object(s.jsx)("input",{className:"simple",type:"number",value:Math.round(e),onChange:function(e){c.points[n][t]=+e.target.value,d(c)}})},"".concat(n).concat(t))}))})),r=Object.entries(e.dir).map((function(t){var n=Object(l.a)(t,2),c=n[0],i=n[1];return Object(s.jsx)("td",{children:Object(s.jsx)("input",{className:"simple",type:"number",value:i?1:0,onChange:function(t){e.dir[c]=+t.target.value>0,d(e)}})},c)}));return Object(s.jsxs)("tr",{children:[i,Object(s.jsx)("td",{children:Object(s.jsx)("input",{type:"checkbox",checked:e.carWalk,onChange:function(){e.carWalk=!e.carWalk,d(e)}})},"iscarwalkable"),r,Object(s.jsx)("td",{children:Object(s.jsx)("input",{type:"checkbox",checked:e.parking,onChange:function(){e.parking=!e.parking,d(e)}})},"isparking"),Object(s.jsx)("td",{children:Object(s.jsx)("input",{className:"simple",type:"text",value:null!==(c=e.stop)&&void 0!==c?c:"None",onChange:function(t){e.stop=t.target.value,d(e)}})},"isstop"),Object(s.jsx)("td",{children:Object(s.jsx)("button",{hidden:!e.changed,onClick:function(){d(e,!1),n([t.find((function(t){return t.id===e.id})).fromAreaDictionary(e)])},children:"update"})},"update"),Object(s.jsx)("td",{children:Object(s.jsx)("button",{hidden:!e.changed,onClick:function(){e=t.find((function(t){return t.id===e.id})).toAreaDictionary(),d(e,!1)},children:"discard"})},"discard")]},e.id)}return Object(c.useEffect)((function(){var e=t.filter((function(e){return e.isSelected}));0===e.length&&(e=t);var n=e.map((function(e){return e.toAreaDictionary()})),c=null===a||void 0===a?void 0:a.filter((function(e){return e.changed}));n=(n=n.map((function(e){var t=null===c||void 0===c?void 0:c.find((function(t){return t.id===e.id}));return t||e}))).sort((function(e,t){return e.id<t.id?-1:1})),o(n)}),[t]),Object(c.useEffect)((function(){console.log(a)}),[a]),Object(s.jsx)("div",{className:"Inspector",children:Object(s.jsxs)("table",{children:[Object(s.jsx)("thead",{children:Object(s.jsxs)("tr",{children:[Object(s.jsx)("th",{children:"luX     "}),Object(s.jsx)("th",{children:"luY     "}),Object(s.jsx)("th",{children:"ruX     "}),Object(s.jsx)("th",{children:"ruY     "}),Object(s.jsx)("th",{children:"rbX     "}),Object(s.jsx)("th",{children:"rbY     "}),Object(s.jsx)("th",{children:"lbX     "}),Object(s.jsx)("th",{children:"lbY     "}),Object(s.jsx)("th",{children:"CarWalk "}),Object(s.jsx)("th",{children:"Left    "}),Object(s.jsx)("th",{children:"Up      "}),Object(s.jsx)("th",{children:"Right   "}),Object(s.jsx)("th",{children:"Down    "}),Object(s.jsx)("th",{children:"Parking "}),Object(s.jsx)("th",{children:"Stop    "})]})}),Object(s.jsx)("tbody",{children:null===a||void 0===a?void 0:a.map((function(e){return j(e)}))})]})})}n(24);var E=["luX","luY","ruX","ruY","rbX","rbY","lbX","lbY","CarWalk","Left","Up","Right","Down","Parking","Stop"];function N(e){var t=e.target,n=e.source,i=Object(c.useRef)(null),r=n?n.replace(".mp4","_areas.csv"):"areas.csv",a=function(e){var t=e.map(u);return[E.join(",")].concat(t).join("\n")},u=function(e){var t=b(e.shape).map((function(e){return[Math.round(e[0]),Math.round(e[1])].join(",")})).join(","),n=e.isCarWalkable?"1":"0",c=e.direction?e.direction:[0,0];return[t,n,[p(c,[-1,0])>.25?"1":"0",p(c,[0,-1])>.25?"1":"0",p(c,[1,0])>.25?"1":"0",p(c,[0,1])>.25?"1":"0"].join(","),e.isCarWalkable?"1":"0",e.stop?""+e.stop:"None"].join(",")};return Object(s.jsxs)("div",{className:"IOManager",children:[Object(s.jsx)("button",{onClick:function(){var e,n,c=a(t),r=new Blob([c],{type:"text/csv;charset=utf-8;"}),u=URL.createObjectURL(r);null===(e=i.current)||void 0===e||e.setAttribute("href",u),null===(n=i.current)||void 0===n||n.click(),URL.revokeObjectURL(u)},children:"Download"}),Object(s.jsx)("a",{ref:i,download:r,hidden:!0})]})}function A(){var e=Object(c.useState)(null),t=Object(l.a)(e,2),n=t[0],i=t[1],r=Object(c.useState)(""),a=Object(l.a)(r,2),f=a[0],h=a[1],b=Object(c.useState)(null),v=Object(l.a)(b,2),O=v[0],p=v[1],x=Object(c.useState)(),g=Object(l.a)(x,2),k=g[0],y=g[1],C=Object(c.useState)([]),E=Object(l.a)(C,2),A=E[0],L=E[1],W=Object(c.useState)(m.ADD),R=Object(l.a)(W,2),T=R[0],P=R[1];Object(c.useEffect)((function(){if(n){var e=URL.createObjectURL(n);h(e)}}),[n]);var M=function(e){A.map((function(e){return e.isSelected=!1})),e>=0&&e<A.length&&(A[e].isSelected=!0),L(Object(u.a)(A))},U=function(e){var t=A.filter((function(t){var n,c=Object(o.a)(e);try{for(c.s();!(n=c.n()).done;){var i=n.value;if(t.id===i.id)return!1}}catch(r){c.e(r)}finally{c.f()}return!0}));L([].concat(Object(u.a)(e),Object(u.a)(t)))};return Object(s.jsxs)("div",{className:"App",children:[Object(s.jsxs)("div",{children:[Object(s.jsxs)("div",{className:"BlockCanvas",children:[Object(s.jsx)(D,{img:O,quads:A,newQuad:function(e){return L([e].concat(Object(u.a)(A)))},tool:T,setSelected:M,moveSelected:function(e){var t=A.filter((function(e){return e.isSelected}));t.map((function(t){var n,c=Object(o.a)(t.shape);try{for(c.s();!(n=c.n()).done;){var i=n.value;i[0]+=e[0],i[1]+=e[1]}}catch(r){c.e(r)}finally{c.f()}})),U(t)},deleteSelected:function(){var e=A.filter((function(e){return!e.isSelected}));L(e)},slider:k,width:null===O||void 0===O?void 0:O.videoWidth,height:null===O||void 0===O?void 0:O.videoHeight}),Object(s.jsx)(d,{source:f,setVideo:p,setSlider:y,value:null!==k&&void 0!==k?k:0})]}),Object(s.jsxs)("div",{className:"BlockButtons",children:[Object(s.jsx)(S,{value:T,onAdd:function(){P(m.ADD),M(-1)},onSelect:function(){P(m.SELECT),M(-1)}}),Object(s.jsx)(j,{setFile:i,accept_types:"video/*"}),Object(s.jsx)(N,{target:A,source:null===n||void 0===n?void 0:n.name})]})]}),Object(s.jsx)("div",{children:Object(s.jsx)(w,{target:A,update:U})})]})}var L=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,26)).then((function(t){var n=t.getCLS,c=t.getFID,i=t.getFCP,r=t.getLCP,a=t.getTTFB;n(e),c(e),i(e),r(e),a(e)}))};a.a.render(Object(s.jsx)(i.a.StrictMode,{children:Object(s.jsx)(A,{})}),document.getElementById("root")),L()}],[[25,1,2]]]);
//# sourceMappingURL=main.3ca76cf6.chunk.js.map