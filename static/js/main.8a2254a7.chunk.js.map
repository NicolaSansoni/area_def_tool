{"version":3,"sources":["components/Video.tsx","components/FilePicker.tsx","utilities/data.ts","utilities/shapes.ts","utilities/area.ts","utilities/types.ts","components/ToolSelector.tsx","components/Canvas.tsx","components/Inspector.tsx","components/IOManager.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["Video","source","setVideo","setSlider","videoRef","value","useRef","useEffect","current","src","loader","setTimeout","duration","setVideoPos","percentage","currentTime","className","type","min","max","onChange","ev","target","ref","hidden","FilePicker","setFile","accept_types","Button","variant","color","onClick","click","accept","_","files","item","order","s","lu","sort","a","b","slice","i_lu","findIndex","p","ordered","nextP","length","prevP","i","push","isPointInShape","res","edge","distancePointToPoint","Math","hypot","projectPointToSegment","l","lineVec","vecSub","lineLen","lineVecNormalized","vecScale","pointProjLen","dot","vecSum","vec1","vec2","v1","v2","v","n","vecFromCoordinateSystem","up","right","vecToCoordinateSystem","y","vecRotate","upRotated","vecLen","Tool","Area","quad","direction","id","shape","isCarWalkable","isParking","stop","isSelected","this","newId","points","dir","map","x","round","ru","rb","lb","carWalk","left","down","parking","ad","Object","values","dirs","entries","k","reduce","vec","counter","ToolSelector","onSelect","onAdd","ADD","SELECT","alpha","style1","width","stroke","fill","arrow","selected","style2","Canvas","img","quads","newQuad","tool","setSelected","updateQuads","deleteQuads","slider","height","useState","setPoints","dragging","setDragging","oldMouse","setOldMouse","dragIndexes","setDragIndexes","mouse","setMouse","canvasH","canvasW","canvas","context","getContext","Error","drawImage","e","fillStyle","fillRect","movement","style","lineWidth","strokeStyle","some","snapToShapes","filter","drawPath","drawArrow","drawParking","close","path","pos","shapes","flat","dist","point","d","minDist","newPoint","p1","p2","proj","canvasCtx","f_drawPoints","moveTo","beginPath","lineTo","closePath","drawPoint","tmpFill","tmpStroke","arc","dirVec","diag","diagInPerspective","ratioX","ratioY","lenUp","lenRight","ratio","handleSelect","find","indexes","distance","res_d","res_i","res_is","j","findPointInShapeIndex","tmpWidth","stopDragging","selectedAreas","updated","onMouseDown","updatedShape","newArea","addPoint","onMouseUp","onMouseLeave","q","onMouseMove","clientWidth","topLeft","offsetLeft","offsetTop","pageX","pageY","Inspector","update","selectById","inspected","setInspected","updateInspected","changed","unchanged","renderAD","renderedPoints","flatMap","key","val","renderedDirection","checked","t","fromAreaDictionary","Check","toAreaDictionary","Clear","list","pending","fields","IOManager","load","dlRef","loadRef","filename","replace","formatData","formatted","formatArea","join","concat","area","f","console","error","text","csv","rows","split","strings","r","dictionaries","vals","newAreas","outStr","blob","Blob","dlUrl","URL","createObjectURL","setAttribute","revokeObjectURL","download","App","file","videoSrc","setVideoSrc","video","quadList","setQuadList","setTool","index","notUpdated","every","filteredList","videoWidth","undefined","videoHeight","name","arr","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","theme","createMuiTheme","palette","primary","main","blue","secondary","red","typography","button","fontWeight","overrides","MuiButton","outlined","border","ReactDOM","render","StrictMode","ThemeProvider","CssBaseline","document","getElementById"],"mappings":"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","file":"static/js/main.8a2254a7.chunk.js","sourcesContent":["import React, { useEffect, useRef } from 'react';\n\nimport './Video.css';\n\ntype VideoProps = {\n    source: string;\n    setVideo: (video: HTMLVideoElement) => void;\n    setSlider: (value: number | undefined) => void;\n    value: number;\n};\n\nexport default function Video({ source, setVideo, setSlider, value }: VideoProps) {\n\n    const videoRef = useRef<HTMLVideoElement>(null);\n\n    useEffect(() => {\n        if (videoRef.current && source) {\n            videoRef.current.src = source;\n            setVideo(videoRef.current);\n\n            const loader = () => {\n                setTimeout(() => {\n                    if (videoRef.current?.duration) {\n                        setVideoPos(1);\n                    } else loader();\n                }, 10);\n            };\n\n            loader();\n        }\n    }, [source]);\n\n    const setVideoPos = (percentage: number) => {\n        if (!videoRef.current || !source || !percentage) {\n            return;\n        }\n        // force range 0 - 100\n        const value = percentage < 1 ? 1 : percentage > 100 ? 100 : percentage;\n        videoRef.current.currentTime = value / 100 * videoRef.current.duration;\n        setSlider(value);\n    };\n\n    return (\n        <div className=\"VideoCanvas\">\n            <input className=\"slider\"\n                type=\"range\"\n                min=\"1\"\n                max=\"100\"\n                onChange={ev => { setVideoPos(+ev.target.value); }}\n            />\n            <video ref={videoRef} hidden />\n        </div>\n    );\n}\n","import React, { useRef, useEffect, useState } from 'react';\nimport { Button } from '@material-ui/core';\n\nimport './FilePicker.css';\n\ntype FilePickerProps = {\n    setFile: (f: File | null) => void,\n    accept_types?: string;\n};\n\nfunction FilePicker({ setFile, accept_types = \"\" }: FilePickerProps) {\n\n    const ref = useRef<HTMLInputElement>(null);\n\n    return (\n        <div className=\"FilePicker\">\n            <Button variant=\"contained\" color=\"primary\"\n                onClick={() => ref.current?.click()}\n            >\n                Select Video\n            </Button>\n            <input hidden\n                ref={ref}\n                type=\"file\"\n                accept={accept_types}\n                onChange={_ => setFile(ref.current?.files?.item(0) ?? null)}\n            />\n        </div>\n    );\n}\n\nexport default FilePicker;","import { Shape } from './types';\n\nexport function order(s: Shape) {\n    const X = 0;\n    const Y = 1;\n\n    let lu = [...s].sort((a, b) => a[Y] < b[Y] ? -1 : 1).slice(0, 2).sort((a, b) => a[X] < b[X] ? -1 : 1)[0];\n    let i_lu = s.findIndex(p => p === lu);\n\n    const ordered: Shape = [];\n    const nextP = s[(i_lu + 1) % s.length];\n    const prevP = s[(i_lu + s.length - 1) % s.length];\n\n    if (nextP[Y] < prevP[Y]) {\n        for (let i = 0; i < s.length; i++) {\n            const p = s[(i_lu + i) % s.length];\n            ordered.push([...p]);\n        }\n    } else {\n        for (let i = 0; i < s.length; i++) {\n            const p = s[(i_lu + s.length - i) % s.length];\n            ordered.push([...p]);\n        }\n    }\n\n    return ordered; // force copy;\n}","import { Vector, Shape } from './types';\n\nexport function findPointInShapeIndex(target: Vector, shapes: Shape[]) {\n    for (let i = 0; i < shapes.length; i++) {\n        if (isPointInShape(target, shapes[i])) return i;\n    }\n    return -1;\n}\n\nexport function isPointInShape(p: Vector, s: Shape) {\n    let res = false;\n    const X = 0;\n    const Y = 1;\n    for (let i = 0; i < s.length; i++) {\n        // https://www.eecs.umich.edu/courses/eecs380/HANDOUTS/PROJ2/InsidePoly.html\n        const edge = [s[i], s[(i + 1) % s.length]];\n        if (\n            (   // is the point in the Y range of the edge?\n                edge[0][Y] <= p[Y] && edge[1][Y] >= p[Y] ||\n                edge[1][Y] <= p[Y] && edge[0][Y] >= p[Y]\n            )\n            &&\n            (   // is our point to the left the line that our edge sits on at Y = point[Y]?\n                p[X] < (edge[0][X] - edge[1][X]) * (p[Y] - edge[1][Y]) / (edge[0][Y] - edge[1][Y]) + edge[1][X]\n            )\n        ) {\n            res = !res;\n        }\n    }\n    return res;\n}\n\nexport function distancePointToPoint(a: Vector, b: Vector) {\n    // Pitagora\n    return Math.hypot(a[0] - b[0], a[1] - b[1]);\n}\n\nfunction badProjectPointToSegment(p: Vector, l: [Vector, Vector]) {\n    // WHY DID I EVEN BOTHER WITH ALL OF THIS MATH\n    const [x, y] = [p[0], p[1]];\n    const [x1, y1] = [l[0][0], l[0][1]];\n    const [x2, y2] = [l[1][0], l[1][1]];\n\n    // find m and q of the segment line\n    const m = (y1 - y2) / (x1 - x2);\n    const q = (x1 * y2 - x2 * y1) / (x1 - x2);\n\n    // find m and q of the projection line\n    const mproj = -1 / m;\n    const qproj = y - mproj * x;\n\n    // solve the system and find the point that sits on both lines\n    const xproj = (qproj - q) / (m - mproj);\n    const yproj = m * xproj + q;\n\n    const proj = [xproj, yproj] as Vector;\n\n    if (\n        proj[0] > l[0][0] && proj[0] > l[1][0] || // too far left\n        proj[0] < l[0][0] && proj[0] < l[1][0] || // too far right\n        proj[1] > l[0][1] && proj[1] > l[1][1] || // too far up\n        proj[1] < l[0][1] && proj[1] < l[1][1]    // too far down\n    ) {\n        return null;\n    }\n    return proj;\n}\n\nexport function projectPointToSegment(p: Vector, l: [Vector, Vector]): Vector | null {\n    // WHY DO I ONLY THINK OF VECTORS IN MY FREE TIME AND NOT WHEN I'M ON THE CLOCK??????\n    const lineVec = vecSub(l[1], l[0]);\n    const lineLen = distancePointToPoint(l[0], l[1]);\n    const lineVecNormalized = vecScale(lineVec, 1 / lineLen);\n    const pointProjLen = dot(vecSub(p, l[0]), lineVecNormalized);\n    if (pointProjLen < 0 || pointProjLen > lineLen) return null; // proj outside the segment\n    const pointProj = vecSum(l[0], vecScale(lineVecNormalized, pointProjLen));\n    return pointProj;\n}\n\nexport function dot(vec1: Vector, vec2: Vector) {\n    return vec1[0] * vec2[0] + vec1[1] * vec2[1];\n}\n\nexport function vecSum(v1: Vector, v2: Vector): Vector {\n    return [v1[0] + v2[0], v1[1] + v2[1]];\n}\n\nexport function vecNegative(v: Vector): Vector {\n    return [-v[0], -v[1]];\n}\n\nexport function vecSub(v1: Vector, v2: Vector): Vector {\n    return vecSum(v1, vecNegative(v2));\n}\n\nexport function vecScale(v: Vector, n: number): Vector {\n    return [v[0] * n, v[1] * n];\n}\n\nexport function vecLen(v: Vector): number {\n    return distancePointToPoint([0, 0], v);\n}\n\nexport function vecFromCoordinateSystem(v: Vector, up: Vector, right: Vector): Vector {\n    return vecSum(vecScale(right, v[0]), vecScale(up, v[1]));\n}\n\nexport function vecToCoordinateSystem(v: Vector, up: Vector, right: Vector): Vector {\n    /* \n        x1 = rx * x + ux * y \n        y1 = ry * x + uy * y\n\n        x = (x1 - ux * y) / rx = (y1 - uy * y) / ry => \n        x1 * ry - ux * ry * y = y1 * rx - uy * rx * y =>\n        y = (x1 * ry - y1 * rx) / (ux * ry - uy * rx)\n     */\n    const y = (v[0] * right[1] - v[1] * right[0]) / (up[0] * right[1] - up[1] * right[0]);\n    const x = (v[0] - up[0] * y) / right[0];\n    return [x, y];\n}\n\nexport function vecRotate(v: Vector, upRotated: Vector): Vector {\n    const up = vecScale(upRotated, 1 / vecLen(upRotated));\n    const right = [up[1], -up[0]] as Vector;\n    return vecFromCoordinateSystem(v, up, right);\n}\n\nexport function centroidOfShape(shape: Shape) {\n    const sum = shape.reduce((res, v) => vecSum(v, res));\n    return vecScale(sum, 1 / shape.length);\n}\n\nexport function dirShapeToShape(s1: Shape, s2: Shape) {\n    const center1 = centroidOfShape(s1);\n    const center2 = centroidOfShape(s2);\n    const lineC1toC2 = vecSub(center2, center1);\n    const distance = distancePointToPoint([0, 0], lineC1toC2);\n    return vecScale(lineC1toC2, 1 / distance);\n}","import { order } from './data';\nimport { dot, vecSum } from './shapes';\nimport { AreaDictionary, IIndexable, Vector, Shape } from './types';\n\nexport class Area {\n    private static counter = 0;\n\n    readonly id: number;\n    public shape: Shape;\n    public isCarWalkable = true;\n    public direction: Vector | null = null;\n    public isParking = false;\n    public stop: string | null = null;\n    public isSelected = false;\n\n    constructor(quad?: Shape, direction?: Vector) {\n        this.id = Area.newId();\n        this.shape = quad ?? [[-1, -1], [-1, -1], [-1, -1], [-1, -1]];\n        if (direction) this.direction = direction;\n    }\n\n    static newId() {\n        return Area.counter++;\n    }\n\n    toAreaDictionary(): AreaDictionary {\n        const points = order(this.shape);\n        const dir = this.direction ?? [0, 0];\n        return {\n            id: this.id,\n            points: {\n                lu: points[0].map(x => Math.round(x)) as Vector,\n                ru: points[1].map(x => Math.round(x)) as Vector,\n                rb: points[2].map(x => Math.round(x)) as Vector,\n                lb: points[3].map(x => Math.round(x)) as Vector,\n            },\n            carWalk: this.isCarWalkable,\n            dir: {\n                left: dot(dir, [-1, 0]) > .25 ? true : false,\n                up: dot(dir, [0, 1]) > .25 ? true : false,\n                right: dot(dir, [1, 0]) > .25 ? true : false,\n                down: dot(dir, [0, -1]) > .25 ? true : false,\n            },\n            parking: this.isParking,\n            stop: `${this.stop ?? \"None\"}`,\n            ref: this,\n        };\n    }\n\n    fromAreaDictionary(ad: AreaDictionary) {\n        this.shape = Object.values(ad.points);\n        this.isCarWalkable = ad.carWalk;\n        const dirs = {\n            left: [-1, 0],\n            right: [1, 0],\n            up: [0, 1],\n            down: [0, -1],\n        };\n        this.direction = Object.entries(ad.dir)\n            .map(([k, v]) => v ? (dirs as IIndexable)[k] : [0, 0])\n            .reduce((res, vec) => vecSum(res, vec));\n\n        this.isParking = ad.parking;\n        this.stop = ad.stop;\n        ad.ref = this;\n        return this;\n    }\n}","import { Area } from \"./area\";\n\nexport type Vector = [number, number];\nexport type Shape = Vector[];\nexport enum Tool { ADD, SELECT };\n\nexport type AreaDictionary = {\n    id: number;\n    points: {\n        lu: Vector;\n        ru: Vector;\n        rb: Vector;\n        lb: Vector;\n    };\n    carWalk: boolean;\n    dir: {\n        left: boolean;\n        up: boolean;\n        right: boolean;\n        down: boolean;\n    };\n    parking: boolean;\n    stop: string;\n    changed?: boolean;\n    ref?: Area;\n};\n\nexport interface IIndexable<T = any> { [key: string]: T; }\n\nexport { Area } from \"./area\";","import React from 'react';\nimport { Tool } from '../utilities/types';\nimport { Button } from '@material-ui/core';\nimport './ToolSelector.scss';\n\ntype ToolSelectorProps = {\n    value?: Tool;\n    onSelect?: () => void;\n    onAdd?: () => void;\n};\n\nexport default function ToolSelector({ value, onSelect, onAdd }: ToolSelectorProps) {\n    return (\n        <div className=\"ToolSelector\">\n            <Button\n                variant={value === Tool.ADD ? \"contained\" : \"outlined\"}\n                color=\"secondary\"\n                onClick={onAdd}\n            >\n                ADD\n            </Button>\n\n            <Button\n                variant={value === Tool.SELECT ? \"contained\" : \"outlined\"}\n                color=\"secondary\"\n                onClick={onSelect}\n            >\n                SELECT\n            </Button>\n        </div>\n    );\n}","import React, { useRef, useState, useEffect } from 'react';\nimport './Canvas.scss';\nimport { Area, Vector, Shape, Tool } from '../utilities/types';\nimport { distancePointToPoint, projectPointToSegment, findPointInShapeIndex, vecSum, vecScale, vecFromCoordinateSystem, isPointInShape, vecRotate, vecSub, vecToCoordinateSystem } from '../utilities/shapes';\nimport { order } from '../utilities/data';\n\nconst CANVAS_W = 1920;\nconst CANVAS_H = 1080;\nconst POINT_RADIUS = 5;\nconst SNAP_DISTANCE = 25;\nconst ARROW_SCALE = .25;\n// const ARROW_SIZE = 50;\n\nconst alpha = .25;\n\nconst style1 = {\n    width: 2,\n    stroke: `rgb(250, 50, 50)`,\n    fill: `rgba(250, 50, 50, ${alpha})`,\n    arrow: `rgba(250, 50, 50, ${alpha * 2})`,\n    selected: {\n        width: 2,\n        stroke: `rgb(255, 200, 50)`,\n        fill: `rgba(255, 200, 50, ${alpha})`,\n        arrow: `rgba(255, 200, 50, ${alpha * 2})`,\n    },\n};\n\nconst style2 = {\n    width: 2,\n    stroke: `rgb(50, 50, 250)`,\n    fill: `rgba(50, 50, 250, ${alpha})`,\n    arrow: `rgba(50, 50, 250, ${alpha * 2})`,\n    selected: {\n        width: 2,\n        stroke: `rgb(50, 250, 250)`,\n        fill: `rgba(50, 250, 250, ${alpha})`,\n        arrow: `rgba(50, 250, 250, ${alpha * 2})`,\n    },\n};\n\nexport interface CanvasProps {\n    img: CanvasImageSource | null;\n    quads: Area[];\n    newQuad: (quad: Area) => void;\n    tool: Tool;\n    setSelected: (index: number) => void;\n    updateQuads: (arr: Area[]) => void;\n    deleteQuads: (arr: Area[]) => void;\n    slider?: number;\n    width?: number;\n    height?: number;\n};\n\nexport default function Canvas({\n    img, quads, newQuad, tool, setSelected, updateQuads, deleteQuads, slider, width, height\n}: CanvasProps) {\n\n    const [points, setPoints] = useState<Shape>([]);\n    const [dragging, setDragging] = useState<boolean>(false);\n    const [oldMouse, setOldMouse] = useState<Vector | null>(null);\n    const [dragIndexes, setDragIndexes] = useState<number[] | null>(null);\n\n    const ref = useRef<HTMLCanvasElement>(null);\n    const [mouse, setMouse] = useState<{ x: number, y: number; }>({ x: 0, y: 0 });\n\n    let canvasH = CANVAS_H;\n    let canvasW = CANVAS_W;\n\n    useEffect(() => {\n        const canvas = ref.current;\n        const context = canvas?.getContext('2d');\n        if (!canvas || !context) {\n            return;\n        }\n\n        canvasH = canvas.height;\n        canvasW = canvas.width;\n\n        // Background\n        try {\n            if (!img) throw Error;\n            context.drawImage(img, 0, 0, canvas.width, canvas.height);\n        } catch (e) {\n            context.fillStyle = '#fff';\n            context.fillRect(0, 0, canvas.width, canvas.height);\n        }\n\n        let movement: Vector = [0, 0];\n        // Drag\n        if (dragging && oldMouse) {\n            movement = [mouse.x! - oldMouse[0], mouse.y! - oldMouse[1]] as Vector;\n        }\n\n        // Finished Quads\n        for (const quad of quads) {\n            let style;\n            if (quad.isCarWalkable) {\n                style = style1;\n            } else {\n                style = style2;\n            }\n            if (quad.isSelected)\n                style = style.selected;\n\n            context.lineWidth = style.width;\n            context.strokeStyle = style.stroke;\n            context.fillStyle = style.fill;\n\n            const shape = quad.isSelected\n                ? quad.shape.map((p, i) => {\n                    if (dragIndexes && dragIndexes.some(n => n === i))\n                        return snapToShapes(vecSum(p, movement), quads.filter(a => a.id !== quad.id).map(a => a.shape));\n                    else return p;\n                })\n                : quad.shape;\n\n\n            drawPath(context, shape, quad.isSelected);\n            drawArrow(context, shape, quad.direction ?? [0, 0], style.arrow);\n            if (quad.isParking) drawParking(context, shape, \"#f3f\");\n        }\n\n        if (mouse.x && mouse.y) {\n\n            // New Quad\n            if (points && tool === Tool.ADD) {\n                let close = false;\n                const pos = snapToShapes([mouse.x, mouse.y], quads.map(a => a.shape));\n                let path = [pos, ...points];\n                if (points.length === 3) {\n                    close = true;\n                }\n                context.lineWidth = style1.width;\n                context.strokeStyle = style1.stroke;\n                context.fillStyle = style1.fill;\n                drawPath(context, path, true, close);\n            }\n\n\n        }\n    }, [img, quads, tool, mouse, points, slider, width]);\n\n    const snapToShapes = (pos: Vector, shapes: Shape[]) => {\n        // give priority to points instead of edges\n        // find the closest point\n        shapes.push([[0, 0], [canvasW, 0], [canvasW, canvasH], [0, canvasH]]); // add boundaries\n        let [minDist, newPoint] = shapes.flat().reduce(([dist, point]: [number, Vector | null], p) => {\n            const d = distancePointToPoint(pos, p);\n            if (d < dist || dist === -1) return [d, p];\n            else return [dist, point];\n        }, [-1, null]);\n\n        if (newPoint && minDist < SNAP_DISTANCE) {\n            pos = newPoint;\n        } else {\n            [minDist, newPoint] = shapes.reduce(([dist, point]: [number, Vector | null], s) => {\n                // find the closest point in the edges\n                let [d, p] = s.reduce(([dist, point]: [number, Vector | null], p1, i, s) => {\n\n                    const p2 = s[(i + 1) % s.length];\n                    let proj = projectPointToSegment(pos, [p1, p2]);\n                    let d, p;\n                    // if we found a projection it is the closest point\n                    if (proj) {\n                        d = distancePointToPoint(pos, proj);\n                        p = proj;\n                        // confront it with the previous results\n                        if (d < dist || dist === -1) return [d, p];\n                    }\n                    return [dist, point];\n                }, [-1, null]);\n\n                // confront it with the previous results\n                if (p && d < dist || dist === -1) return [d, p];\n                return [dist, point];\n            }, [-1, null]);\n\n            if (newPoint && minDist < SNAP_DISTANCE) {\n                pos = newPoint;\n            }\n        }\n\n        return pos;\n    };\n\n    const addPoint = () => {\n        if (!mouse.x || !mouse.y) {\n            return;\n        }\n\n        let pos: Vector = [mouse.x, mouse.y];\n\n        pos = snapToShapes(pos, quads.map(a => a.shape));\n\n        const updatedShape = [pos, ...points];\n\n        if (updatedShape.length === 4) {\n            const newArea = new Area(order(updatedShape), [0, 1]);\n            newArea.isSelected = true;\n            setSelected(-1);\n            newQuad(newArea);\n            setPoints([]);\n        } else {\n            setPoints(updatedShape);\n        }\n    };\n\n    const drawPath = (canvasCtx: CanvasRenderingContext2D, points: [number, number][], f_drawPoints = false, close = true) => {\n        if (points[0])\n            canvasCtx.moveTo(points[0][0], points[0][1]);\n        canvasCtx.beginPath();\n        for (const p of points) {\n            canvasCtx.lineTo(p[0], p[1]);\n        }\n\n        if (close)\n            canvasCtx.closePath();\n\n        canvasCtx.stroke();\n        canvasCtx.fill();\n\n        if (f_drawPoints) {\n            for (const p of points)\n                drawPoint(canvasCtx, p);\n        }\n    };\n\n    const drawPoint = (canvasCtx: CanvasRenderingContext2D, point: Vector) => {\n        const tmpFill = canvasCtx.fillStyle;\n        const tmpStroke = canvasCtx.strokeStyle;\n        canvasCtx.fillStyle = \"#5f5\";\n        canvasCtx.strokeStyle = \"#000\";\n        canvasCtx.beginPath();\n        canvasCtx.arc(point[0], point[1], POINT_RADIUS, 0, 2 * 3.15);\n        canvasCtx.closePath();\n        canvasCtx.fill();\n        canvasCtx.stroke();\n        canvasCtx.fillStyle = tmpFill;\n        canvasCtx.strokeStyle = tmpStroke;\n    };\n\n    const drawArrow = (canvasCtx: CanvasRenderingContext2D, quad: Vector[], dirVec: Vector, color = \"#000\") => {\n        // vector that rappresents the Y of the area's coordinate space\n        const up = vecSub(quad[3], quad[0]);\n        // vector that rappresents the X of the area's coordinate space\n        const right = vecSub(quad[1], quad[0]);\n        // vector of the diagonal in canvas' coordinates\n        const diag = vecSub(quad[2], quad[0]);\n        // vector of the diagonal in the area's coordinates\n        const diagInPerspective = vecToCoordinateSystem(diag, up, right);\n        // Since we are using the vector not normalized we are in effect mapping 0,0 to the top left,\n        //   0,1 to the bottom left, 1,0 to top right and 1,1 to the bottom right point of our area.\n        // However since the sides aren't parallel we are in effect stretching the coordinate space along\n        //   the diagonal. By diving the difference between the lenght of the projection of the diagonal\n        //   on the axis and the lenght of the \"axis\" itself in the coordinate space of the area we can \n        //   stretch the image by that amount to match have it fit and match the area's perspective.\n        // Since we are mapping the entire area in the square 0,0 - 1,1 the \"axis\" have lenght 1, \n        //   so we can subtract 1 and skip the division.\n        const ratioX = diagInPerspective[0] - 1;\n        const ratioY = diagInPerspective[1] - 1;\n\n        const lenUp = distancePointToPoint(quad[2], quad[1]) + distancePointToPoint(quad[3], quad[0]);\n        const lenRight = distancePointToPoint(quad[2], quad[3]) + distancePointToPoint(quad[1], quad[0]);\n        const ratio = lenUp / lenRight;\n\n        // arrow in 1by1 square\n        let arrow: Shape = [[-.5, -.5], [0, .5], [.5, -.5], [0, -.3]];\n        // apply rotation\n        arrow = arrow.map(v => vecRotate(v, dirVec));\n        // flip since we draw from topLeft down\n        arrow = arrow.map(v => [v[0], -v[1]]);\n        // scale down\n        arrow = arrow.map(v => vecScale(v, ARROW_SCALE));\n        // arrow = arrow.map(v => [v[0] * ARROW_SIZE * 2 / lenRight, v[1] * ARROW_SIZE * 2 / lenUp]);\n        arrow = ratio > 1\n            ? arrow.map(v => [v[0], v[1] / ratio])\n            : arrow.map(v => [v[0] * ratio, v[1]]);\n        // move between 0,0 - 1,1\n        arrow = arrow.map(v => vecSum(v, [.5, .5]));\n        // apply perspective scaling\n        arrow = arrow.map(v => {\n            return [\n                v[0] + v[0] * v[1] * ratioX,\n                v[1] + v[0] * v[1] * ratioY,\n            ] as Vector;\n        });\n        // apply coordinate stretching\n        arrow = arrow.map(v => vecFromCoordinateSystem(v, up, right));\n        // move to the area\n        arrow = arrow.map(v => vecSum(v, quad[0]));\n\n        const tmpFill = canvasCtx.fillStyle;\n        const tmpStroke = canvasCtx.strokeStyle;\n        // canvasCtx.fillStyle = \"rgba(0,0,0,0)\";\n        // canvasCtx.strokeStyle = color;\n        canvasCtx.fillStyle = color;\n\n        drawPath(canvasCtx, arrow, false, true);\n\n        canvasCtx.fillStyle = tmpFill;\n        canvasCtx.strokeStyle = tmpStroke;\n    };\n\n    const handleSelect = () => {\n        // check if we have a selected area\n        const selected = quads.find(a => a.isSelected);\n        let indexes: number[] | null = null;\n        if (selected) {\n            // check its closest points and edges to drag them\n            const points = selected.shape;\n            let distance: number;\n            indexes = [-1];\n            // find the closest point to the mouse pointer\n            [distance, indexes[0]] = points.reduce(([res_d, res_i], p, i) => {\n                const d = distancePointToPoint([mouse.x!, mouse.y!], p);\n                return d < res_d ? [d, i] : [res_d, res_i];\n            }, [999, -1]);\n            // if it's too far check if one of the edges is close enough\n            if (distance > SNAP_DISTANCE) {\n                [distance, indexes] = points.reduce(([res_d, res_is], p, i, points) => {\n                    const j = (i + 1) % points.length;\n                    const p1 = points[j];\n                    const proj = projectPointToSegment([mouse.x!, mouse.y!], [p, p1]);\n                    if (!proj) return [res_d, res_is];\n                    const dist = distancePointToPoint([mouse.x!, mouse.y!], proj);\n                    return dist < res_d ? [dist, [i, j]] : [res_d, res_is];\n                }, [999, [-1]]);\n            }\n            // if it's not check if we clicked it and drag the entire shape\n            if (distance > SNAP_DISTANCE) {\n                if (isPointInShape([mouse.x, mouse.y], selected.shape)) {\n                    indexes = [0, 1, 2, 3];\n                } else {\n                    indexes = null;\n                }\n            }\n        }\n\n        if (indexes) {\n            // update the state\n            setDragIndexes(indexes);\n            setDragging(true);\n            setOldMouse([mouse.x!, mouse.y!]);\n        } else {\n            // check if we clicked an area and select it\n            const target = findPointInShapeIndex([mouse.x, mouse.y], quads.map(a => a.shape));\n            setSelected(target);\n        }\n    };\n\n    const drawParking = (canvasCtx: CanvasRenderingContext2D, quad: Vector[], color = \"#000\") => {\n\n        if (quad.length !== 4) return;\n\n        const tmpStroke = canvasCtx.strokeStyle;\n        const tmpWidth = canvasCtx.lineWidth;\n        canvasCtx.strokeStyle = color;\n        canvasCtx.lineWidth = 3;\n\n        drawPath(canvasCtx, [quad[0], quad[2]], false, false);\n        drawPath(canvasCtx, [quad[1], quad[3]], false, false);\n\n        canvasCtx.strokeStyle = tmpStroke;\n        canvasCtx.lineWidth = tmpWidth;\n    };\n\n    const onMouseDown = () => {\n        switch (tool) {\n            case Tool.ADD:\n                addPoint();\n                break;\n            case Tool.SELECT:\n                handleSelect();\n                break;\n            default:\n                throw Error(\"No tool selected???\");\n        }\n    };\n\n    const stopDragging = () => {\n        if (dragging && oldMouse) {\n            const selectedAreas = quads.filter(a => a.isSelected);\n            const movement: Vector = [mouse.x! - oldMouse[0], mouse.y! - oldMouse[1]];\n            const updated = selectedAreas.map(a => {\n                a.shape = a.shape.map((p, i) => {\n                    if (dragIndexes && dragIndexes.some(n => n === i))\n                        return snapToShapes(vecSum(p, movement), quads.filter(b => b.id !== a.id).map(b => b.shape));\n                    else return p;\n                });\n                return a;\n            });\n            updateQuads(updated);\n            setDragging(false);\n            setDragIndexes(null);\n            setOldMouse(null);\n        }\n    };\n\n    const onMouseUp = () => {\n        stopDragging();\n    };\n\n    const onMouseLeave = () => {\n        setPoints([]);\n        if (dragging && dragIndexes?.length === 4) {\n            setDragging(false);\n            setDragIndexes(null);\n            setOldMouse(null);\n            deleteQuads(quads.filter(q => q.isSelected));\n        }\n        else {\n            stopDragging();\n        }\n    };\n    const onMouseMove = (e: React.MouseEvent) => {\n        const canvas = ref.current;\n        if (canvas) {\n            const ratio = canvas.clientWidth / canvas.width;\n            const topLeft = [canvas.offsetLeft, canvas.offsetTop];\n            setMouse({\n                x: (e.pageX - topLeft[0]) / ratio,\n                y: (e.pageY - topLeft[1]) / ratio,\n            });\n        }\n    };\n\n    return (\n        <div className=\"Canvas\">\n            <canvas\n                ref={ref}\n                onMouseDown={onMouseDown}\n                onMouseUp={onMouseUp}\n                onMouseLeave={onMouseLeave}\n                onMouseMove={e => onMouseMove(e)}\n                width={width ?? CANVAS_W}\n                height={height ?? CANVAS_H}\n            />\n        </div>\n    );\n}\n","import React, { useEffect, useState } from 'react';\nimport { Button } from '@material-ui/core';\nimport { Clear, Check, CheckBoxOutlined } from '@material-ui/icons';\nimport { order } from '../utilities/data';\nimport { dot, vecSum } from '../utilities/shapes';\nimport { Area, AreaDictionary, IIndexable, Vector } from '../utilities/types';\n\nimport './Inspector.scss';\n\ntype InspectorProps = {\n    target: Area[];\n    update: (updated: Area[]) => void;\n    selectById: (id: number) => void;\n};\n\nexport default function Inspector({ target, update, selectById }: InspectorProps) {\n\n    const [inspected, setInspected] = useState<AreaDictionary[]>();\n    const updateInspected = (updated: AreaDictionary, changed = true) => {\n        updated.changed = changed;\n        if (!inspected) return;\n        const unchanged = inspected?.filter(a => a.id !== updated.id);\n        setInspected([updated, ...unchanged].sort((a, b) => a.id < b.id ? -1 : 1));\n    };\n\n    useEffect(() => {\n\n        const selected = target;\n\n        // let selected: Area[] = target.filter(a => a.isSelected);\n        // if (selected.length === 0)\n        //     selected = target;\n\n        let list = selected.map(a => a.toAreaDictionary());\n\n        const pending = inspected?.filter(t => t.changed);\n        list = list.map(a => {\n            const t = pending?.find(t => t.id === a.id);\n            return t ? t : a;\n        });\n\n        list = list.sort((a, b) => a.id < b.id ? -1 : 1);\n\n        setInspected(list);\n    }, [target]);\n\n\n    function renderAD(a: AreaDictionary) {\n\n        const renderPoint = (p: Vector, key: string, ref: AreaDictionary) => {\n            return p.map((val, i) => {\n                return (\n                    <td key={`${key}${i}`}>\n                        <input\n                            type=\"number\"\n                            value={Math.round(val)}\n                            onChange={e => {\n                                (ref.points as IIndexable)[key][i] = +e.target.value;\n                                updateInspected(ref);\n                            }}\n                        />\n                    </td>\n                );\n            });\n        };\n\n        const renderedPoints = Object.entries(a.points)\n            .flatMap(([k, v]) => renderPoint(v, k, a));\n\n        const renderedDirection = Object.entries(a.dir)\n            .map(([k, v]) => {\n                return (\n                    <td key={k}>\n                        <input type=\"checkbox\"\n                            checked={v}\n                            onChange={() => {\n                                (a.dir as IIndexable)[k] = !(a.dir as IIndexable)[k];\n                                updateInspected(a);\n                            }}\n                        />\n                    </td>\n                );\n            });\n\n        return (\n            <tr key={a.id} onClick={() => selectById(a.id)} className={a.ref?.isSelected ? \"selected\" : \"\"}>\n                {renderedPoints}\n                <td key=\"iscarwalkable\">\n                    <input type=\"checkbox\"\n                        checked={a.carWalk}\n                        onChange={() => {\n                            a.carWalk = !a.carWalk;\n                            updateInspected(a);\n                        }}\n                    />\n                </td>\n                {renderedDirection}\n                <td key=\"isparking\">\n                    <input type=\"checkbox\"\n                        checked={a.parking}\n                        onChange={() => {\n                            a.parking = !a.parking;\n                            updateInspected(a);\n                        }}\n                    />\n                </td>\n                <td key=\"isstop\">\n                    <input\n                        type=\"text\"\n                        value={a.stop ?? \"None\"}\n                        onChange={e => {\n                            a.stop = e.target.value;\n                            updateInspected(a);\n                        }}\n                    />\n                </td>\n                <td className={!a.changed ? \"hide\" : \"space\"} />\n                <td key=\"update\" className={!a.changed ? \"hide\" : \"\"}>\n                    <Button variant=\"contained\" color=\"primary\"\n\n                        onClick={() => {\n                            updateInspected(a, false);\n                            update([\n                                target.find(t => t.id === a.id)!.fromAreaDictionary(a)\n                            ]);\n                        }}\n                    >\n                        <Check />\n                    </Button>\n                </td>\n                <td key=\"discard\" className={!a.changed ? \"hide\" : \"\"}>\n                    <Button variant=\"contained\" color=\"secondary\"\n                        className={!a.changed ? \"hide\" : \"\"}\n                        onClick={() => {\n                            a = target.find(t => t.id === a.id)!.toAreaDictionary();\n                            updateInspected(a, false);\n                        }}\n                    >\n                        <Clear />\n                    </Button>\n                </td>\n            </tr>\n        );\n    }\n\n    return (\n        <div className=\"Inspector\">\n            <table>\n                <thead>\n                    <tr>\n                        <th>luX     </th>\n                        <th>luY     </th>\n                        <th>ruX     </th>\n                        <th>ruY     </th>\n                        <th>rbX     </th>\n                        <th>rbY     </th>\n                        <th>lbX     </th>\n                        <th>lbY     </th>\n                        <th>CarWalk </th>\n                        <th>Left    </th>\n                        <th>Up      </th>\n                        <th>Right   </th>\n                        <th>Down    </th>\n                        <th>Parking </th>\n                        <th>Stop    </th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {\n                        inspected?.map((a) => renderAD(a))\n                    }\n                </tbody>\n            </table>\n        </div>\n    );\n\n}","import React, { useRef } from 'react';\nimport { Button } from '@material-ui/core';\nimport { Area, AreaDictionary, Vector } from '../utilities/types';\n\nimport './IOManager.css';\n\nconst fields = [\n    \"luX\",\n    \"luY\",\n    \"ruX\",\n    \"ruY\",\n    \"rbX\",\n    \"rbY\",\n    \"lbX\",\n    \"lbY\",\n    \"CarWalk\",\n    \"Left\",\n    \"Up\",\n    \"Right\",\n    \"Down\",\n    \"Parking\",\n    \"Stop\",\n];\n\ntype IOMangerProps = {\n    target: Area[];\n    source?: string;\n    load: (arr: Area[]) => void;\n};\n\nexport function IOManager({ target, source, load }: IOMangerProps) {\n    const dlRef = useRef<HTMLAnchorElement>(null);\n    const loadRef = useRef<HTMLInputElement>(null);\n\n    const filename = source ? source.replace(\".mp4\", \"_areas.csv\") : \"areas.csv\";\n\n    const download = () => {\n        const outStr = formatData(target);\n        const blob = new Blob([outStr], { type: 'text/csv;charset=utf-8;' });\n        const dlUrl = URL.createObjectURL(blob);\n        dlRef.current?.setAttribute(\"href\", dlUrl);\n        dlRef.current?.click();\n        URL.revokeObjectURL(dlUrl);\n    };\n\n    const formatData = (target: Area[]) => {\n        const formatted = target.map(formatArea);\n        return [fields.join(',')].concat(formatted).join('\\n');\n    };\n\n    const formatArea = (area: Area) => {\n        const ad = area.toAreaDictionary();\n\n        const points = [ad.points.lu, ad.points.ru, ad.points.rb, ad.points.lb].map(p => p.join(',')).join(',');\n        const carWalk = ad.carWalk ? 1 : 0;\n        const parking = ad.parking ? 1 : 0;\n        const stop = ad.stop;\n        const direction = [ad.dir.left, ad.dir.up, ad.dir.right, ad.dir.down].map(f => f ? 1 : 0).join(',');\n\n        return [points, carWalk, direction, parking, stop].join(',');\n    };\n\n    const loader = async (f: File | null) => {\n        if (!f) {\n            console.error(\"Unable to load file!\");\n            return;\n        }\n        const csv = await f.text();\n        const rows = csv.split('\\n').filter(s => s !== \"\");\n        const strings = rows.slice(1).map(r => r.split(','));\n        const dictionaries = strings.map(r => {\n            let ad: any = { points: {}, dir: {} };\n            const vals: number[] = r.map(v => +v);\n            ad.points.lu = vals.slice(0, 2) as Vector;\n            ad.points.ru = vals.slice(2, 4) as Vector;\n            ad.points.rb = vals.slice(4, 6) as Vector;\n            ad.points.lb = vals.slice(6, 8) as Vector;\n            ad.carWalk = vals[8] > 0;\n            ad.dir.left = vals[9] > 0;\n            ad.dir.up = vals[10] > 0;\n            ad.dir.right = vals[11] > 0;\n            ad.dir.down = vals[12] > 0;\n            ad.parking = vals[13] > 0;\n            ad.stop = r[14];\n            return ad as AreaDictionary;\n        });\n        const newAreas = dictionaries.map(ad => new Area().fromAreaDictionary(ad));\n        load(newAreas);\n    };\n\n    return (\n        <div className=\"IOManager\">\n            <Button variant=\"contained\" color=\"primary\"\n                onClick={() => loadRef.current?.click()}\n            >\n                Load CSV\n            </Button>\n            <input hidden\n                type=\"file\"\n                ref={loadRef}\n                accept=\".csv\"\n                onChange={() => loader(loadRef.current?.files?.item(0) ?? null)}\n            />\n\n            <Button variant=\"contained\" color=\"primary\"\n                onClick={download}\n            >\n                Download\n            </Button>\n            <a\n                ref={dlRef}\n                download={filename}\n                hidden\n            />\n        </div >\n    );\n}","import React, { useEffect, useState } from 'react';\nimport './App.scss';\nimport Video from './components/Video';\nimport FilePicker from './components/FilePicker';\nimport { Area, Vector, Shape, Tool } from './utilities/types';\nimport ToolSelector from './components/ToolSelector';\nimport Canvas from './components/Canvas';\nimport Inspector from './components/Inspector';\nimport { IOManager } from './components/IOManager';\n\n\nexport default function App() {\n\n    const [file, setFile] = useState<File | null>(null);\n    const [videoSrc, setVideoSrc] = useState<string>(\"\");\n    const [video, setVideo] = useState<HTMLVideoElement | null>(null);\n    const [slider, setSlider] = useState<number | undefined>();\n    const [quadList, setQuadList] = useState<Area[]>([]);\n    const [tool, setTool] = useState<Tool>(Tool.ADD);\n\n    useEffect(() => {\n        if (file) {\n            const source = URL.createObjectURL(file);\n            setVideoSrc(source);\n        }\n    }, [file]);\n\n    const deleteQuads = (quads: Area[]) => {\n        const filteredList = quadList.filter(a => quads.every(b => b.id !== a.id));\n        setQuadList(filteredList);\n    };\n\n    const setSelected = (index: number) => {\n        quadList.map(a => a.isSelected = false);\n        if (index >= 0 && index < quadList.length) {\n            quadList[index].isSelected = true;\n        }\n        setQuadList([...quadList]);\n    };\n\n    const setSelectedById = (id: number) => {\n        setSelected(quadList.findIndex(a => a.id === id));\n    };\n\n    const updateQuads = (quads: Area[]) => {\n        const notUpdated = quadList.filter(a => quads.every(b => b.id !== a.id));\n        setQuadList([...quads, ...notUpdated]);\n    };\n\n    return (\n        <div className=\"App\">\n            <div>\n                <div className=\"BlockCanvas\">\n                    <Canvas\n                        img={video}\n                        quads={quadList}\n                        newQuad={(quad: Area) => setQuadList([quad, ...quadList])}\n                        tool={tool}\n                        setSelected={setSelected}\n                        updateQuads={updateQuads}\n                        deleteQuads={deleteQuads}\n                        slider={slider}\n                        width={video?.videoWidth || undefined}\n                        height={video?.videoHeight || undefined}\n                    />\n                    <Video\n                        source={videoSrc}\n                        setVideo={setVideo}\n                        setSlider={setSlider}\n                        value={slider ?? 0}\n                    />\n                </div>\n                <div className=\"BlockButtons\">\n                    <ToolSelector\n                        value={tool}\n                        onAdd={() => { setTool(Tool.ADD); setSelected(-1); }}\n                        onSelect={() => { setTool(Tool.SELECT); setSelected(-1); }}\n                    />\n                    <FilePicker setFile={setFile} accept_types=\"video/*\" />\n                    <IOManager\n                        target={quadList}\n                        source={file?.name}\n                        load={arr => setQuadList(arr)}\n                    />\n                </div>\n            </div>\n            <div>\n                <Inspector\n                    target={quadList}\n                    update={updateQuads}\n                    selectById={setSelectedById}\n                />\n            </div>\n        </div>\n    );\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport { ThemeProvider, createMuiTheme } from '@material-ui/core/styles';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport { blue, red } from '@material-ui/core/colors';\n\nconst theme = createMuiTheme({\n  palette: {\n    type: \"dark\",\n    primary: {\n      main: blue[400],\n    },\n    secondary: {\n      main: red[400],\n    },\n  },\n  typography: {\n    button: {\n      fontWeight: \"bold\",\n    },\n  },\n  overrides: {\n    MuiButton: {\n      outlined: {\n        border: \"2px solid !important\",\n      }\n    }\n  }\n\n});\n\nReactDOM.render(\n  <React.StrictMode>\n    <ThemeProvider theme={theme}>\n      <CssBaseline />\n      <App />\n    </ThemeProvider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}