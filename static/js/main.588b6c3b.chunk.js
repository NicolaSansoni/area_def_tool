(this["webpackJsonparea-def-tool"]=this["webpackJsonparea-def-tool"]||[]).push([[0],[,,,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var c=n(1),r=n.n(c),i=n(8),a=n.n(i),l=(n(16),n(3)),u=n(4),o=n(2),s=(n(17),n(18),n(0));function j(e){var t=e.source,n=e.setVideo,r=e.setSlider,i=e.value,a=Object(c.useRef)(null);Object(c.useEffect)((function(){a.current&&t&&(a.current.src=t,a.current.currentTime=0,n(a.current))}),[t]);return Object(s.jsxs)("div",{className:"VideoCanvas",children:[Object(s.jsx)("input",{className:"slider",type:"range",min:"0",max:"100",value:i,onChange:function(e){!function(e){if(a.current){var t=e<0?0:e>100?100:e;a.current.currentTime=t/100*a.current.duration,r(t)}}(+e.target.value)}}),Object(s.jsx)("video",{ref:a,hidden:!0})]})}n(20);var d,f=function(e){var t=e.setFile,n=e.accept_types,r=void 0===n?"":n,i=Object(c.useRef)(null);return Object(s.jsx)("div",{className:"FilePicker",children:Object(s.jsx)("input",{ref:i,type:"file",accept:r,onChange:function(e){var n,c,r;return t(null!==(n=null===(c=i.current)||void 0===c||null===(r=c.files)||void 0===r?void 0:r.item(0))&&void 0!==n?n:null)}})})},b=n(9),h=n(10),v=function(){function e(t,n){Object(b.a)(this,e),this.id=void 0,this.shape=void 0,this.isCarWalkable=!0,this.direction=null,this.isParking=!1,this.stop=null,this.isSelected=!1,this.id=e.newId(),this.shape=t,n&&(this.direction=n)}return Object(h.a)(e,null,[{key:"newId",value:function(){return e.counter++}}]),e}();v.counter=0,function(e){e[e.ADD=0]="ADD",e[e.SELECT=1]="SELECT"}(d||(d={}));n(21);function O(e){var t=e.value,n=e.onSelect,c=e.onAdd;return Object(s.jsxs)("div",{className:"ToolSelector",children:[Object(s.jsx)("button",{className:t===d.SELECT?"active":"",onClick:n,children:"SELECT"}),Object(s.jsx)("button",{className:t===d.ADD?"active":"",onClick:c,children:"ADD"})]})}var x=n(11);n(22);function p(e,t){for(var n=!1,c=0;c<t.length;c++){var r=[t[c],t[(c+1)%t.length]];(r[0][1]<=e[1]&&r[1][1]>=e[1]||r[1][1]<=e[1]&&r[0][1]>=e[1])&&e[0]<(r[0][0]-r[1][0])*(e[1]-r[1][1])/(r[0][1]-r[1][1])+r[1][0]&&(n=!n)}return n}function S(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1])}function g(e,t){return e[0]*t[0]+e[1]*t[1]}function m(e,t){return[e[0]+t[0],e[1]+t[1]]}function y(e,t){return m(e,[-(n=t)[0],-n[1]]);var n}function k(e,t){return[e[0]*t,e[1]*t]}function C(e){var t=e.img,n=e.quads,r=e.newQuad,i=e.tool,a=e.setSelected,j=e.moveSelected,f=e.deleteSelected,b=e.slider,h=Object(c.useState)([]),O=Object(o.a)(h,2),C=O[0],D=O[1],w=Object(c.useState)(!1),E=Object(o.a)(w,2),L=E[0],N=E[1],R=Object(c.useState)(null),T=Object(o.a)(R,2),A=T[0],P=T[1],M=Object(c.useRef)(null),U=Object(x.a)(M);Object(c.useEffect)((function(){var e=M.current,c=null===e||void 0===e?void 0:e.getContext("2d");if(e&&c){t?c.drawImage(t,0,0,1280,720):(c.fillStyle="#fff",c.fillRect(0,0,e.width,e.height));var r=[0,0];L&&A&&(r=[U.x-A[0],U.y-A[1]]);var a,o=Object(u.a)(n);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.isSelected?(c.strokeStyle="#ff0",c.fillStyle="#0ff",Y(c,s.shape.map((function(e){return m(e,r)})),!0)):(c.strokeStyle="#f00",c.fillStyle="#00f",Y(c,s.shape,!0))}}catch(b){o.e(b)}finally{o.f()}if(U.x&&U.y&&C&&i===d.ADD){var j=!1,f=[X([U.x,U.y],n.map((function(e){return e.shape})))].concat(Object(l.a)(C));3===C.length&&(j=!0),c.strokeStyle="#f00",c.fillStyle="#00f",Y(c,f,!0,j)}}}),[t,n,i,U,C,b]);var X=function(e,t){var n=t.reduce((function(t,n){var c=Object(o.a)(t,2),r=c[0],i=c[1],a=n.reduce((function(t,n,c,r){var i,a,u=Object(o.a)(t,2),s=u[0],j=u[1],d=r[(c+1)%r.length],f=function(e,t){var n=y(t[1],t[0]),c=S(t[0],t[1]),r=k(n,1/c),i=g(y(e,t[0]),r);return i<0||i>c?null:m(t[0],k(r,i))}(e,[n,d]);if(f)i=S(e,f),a=f;else{var b=S(e,n),h=S(e,d),v=b<h?[b,Object(l.a)(n)]:[h,Object(l.a)(d)],O=Object(o.a)(v,2);i=O[0],a=O[1]}return i<s||-1===s?[i,a]:[s,j]}),[-1,null]),u=Object(o.a)(a,2),s=u[0],j=u[1];return s<r||-1===r?[s,j]:[r,i]}),[-1,null]),c=Object(o.a)(n,2),r=c[0],i=c[1];return i&&r<50&&(e=i),e},Y=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t[0]&&e.moveTo(t[0][0],t[0][1]),e.beginPath();var r,i=Object(u.a)(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;e.lineTo(a[0],a[1])}}catch(j){i.e(j)}finally{i.f()}if(c&&e.closePath(),e.stroke(),n){var l,o=Object(u.a)(t);try{for(o.s();!(l=o.n()).done;){var s=l.value;F(e,s)}}catch(j){o.e(j)}finally{o.f()}}},F=function(e,t){e.beginPath(),e.arc(t[0],t[1],5,0,6.3),e.closePath(),e.fill()},I=function(){var e=function(e,t){for(var n=0;n<t.length;n++)if(p(e,t[n]))return n;return-1}([U.x,U.y],n.map((function(e){return e.shape})));e>=0&&n[e].isSelected?(N(!0),P([U.x,U.y])):a(e)};return Object(s.jsx)("div",{className:"Canvas",children:Object(s.jsx)("canvas",{ref:M,onMouseDown:function(){switch(i){case d.ADD:!function(){if(U.x&&U.y){var e=[U.x,U.y],t=[e=X(e,n.map((function(e){return e.shape})))].concat(Object(l.a)(C));if(4===t.length){var c=new v(t);c.isSelected=!0,a(-1),r(c),D([])}else D(t)}}();break;case d.SELECT:I();break;default:throw Error("No tool selected???")}},onMouseUp:function(){L&&A&&(j([U.x-A[0],U.y-A[1]]),N(!1),P(null))},onMouseLeave:function(){D([]),L&&(N(!1),P(null),f())},width:1280,height:720})})}function D(e){var t=e.sort((function(e,t){return e[1]<t[1]?-1:1}));if(t[0][0]>t[1][0]){var n=t[0];t[0]=t[1],t[1]=n}if(t[2][0]<t[3][0]){var c=t[2];t[2]=t[3],t[3]=c}return t}n(23);function w(e){var t=e.target,n=t.filter((function(e){return e.isSelected}));function c(e){var t,n,c=D(e.shape).map((function(e){return function(e){return[Object(s.jsx)("td",{children:Math.round(e[0])},"x"+e[0]),Object(s.jsx)("td",{children:Math.round(e[1])},"y"+e[1])]}(e)})).reduce((function(e,t){return e.concat(t)}));return Object(s.jsxs)("tr",{children:[c,Object(s.jsx)("td",{children:e.isCarWalkable?"true":"false"},"iscarwalkable"),(n=e.direction,n||(n=[0,0]),[Object(s.jsxs)("td",{children:[" ",g(n,[-1,0])>.25?1:0]},"left"),Object(s.jsxs)("td",{children:["   ",g(n,[0,-1])>.25?1:0]},"up"),Object(s.jsx)("td",{children:g(n,[1,0])>.25?1:0},"right"),Object(s.jsxs)("td",{children:[" ",g(n,[0,1])>.25?1:0]},"down")]),Object(s.jsx)("td",{children:e.isParking?"true":"false"},"isparking"),Object(s.jsx)("td",{children:null!==(t=e.stop)&&void 0!==t?t:"None"},"isstop")]},e.id)}return 0===n.length&&(n=t),Object(s.jsx)("div",{className:"Inspector",children:Object(s.jsxs)("table",{children:[Object(s.jsx)("thead",{children:Object(s.jsxs)("tr",{children:[Object(s.jsx)("th",{children:"luX     "}),Object(s.jsx)("th",{children:"luY     "}),Object(s.jsx)("th",{children:"ruX     "}),Object(s.jsx)("th",{children:"ruY     "}),Object(s.jsx)("th",{children:"rbX     "}),Object(s.jsx)("th",{children:"rbY     "}),Object(s.jsx)("th",{children:"lbX     "}),Object(s.jsx)("th",{children:"lbY     "}),Object(s.jsx)("th",{children:"CarWalk "}),Object(s.jsx)("th",{children:"Left    "}),Object(s.jsx)("th",{children:"Up      "}),Object(s.jsx)("th",{children:"Right   "}),Object(s.jsx)("th",{children:"Down    "}),Object(s.jsx)("th",{children:"Parking "}),Object(s.jsx)("th",{children:"Stop    "})]})}),Object(s.jsx)("tbody",{children:n.map((function(e){return c(e)}))})]})})}n(24);var E=["luX","luY","ruX","ruY","rbX","rbY","lbX","lbY","CarWalk","Left","Up","Right","Down","Parking","Stop"];function L(e){var t=e.target,n=e.source,r=Object(c.useRef)(null),i=n?n.replace(".mp4","_areas.csv"):"areas.csv",a=function(e){var t=e.map(l);return[E.join(",")].concat(t).join("\n")},l=function(e){var t=D(e.shape).map((function(e){return[Math.round(e[0]),Math.round(e[1])].join(",")})).join(","),n=e.isCarWalkable?"1":"0",c=e.direction?e.direction:[0,0];return[t,n,[g(c,[-1,0])>.25?"1":"0",g(c,[0,-1])>.25?"1":"0",g(c,[1,0])>.25?"1":"0",g(c,[0,1])>.25?"1":"0"].join(","),e.isCarWalkable?"1":"0",e.stop?""+e.stop:"None"].join(",")};return Object(s.jsxs)("div",{className:"IOManager",children:[Object(s.jsx)("button",{onClick:function(){var e,n,c=a(t),i=new Blob([c],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(i);null===(e=r.current)||void 0===e||e.setAttribute("href",l),null===(n=r.current)||void 0===n||n.click(),URL.revokeObjectURL(l)},children:"Download"}),Object(s.jsx)("a",{ref:r,download:i,hidden:!0})]})}function N(){var e=Object(c.useState)(null),t=Object(o.a)(e,2),n=t[0],r=t[1],i=Object(c.useState)(""),a=Object(o.a)(i,2),b=a[0],h=a[1],v=Object(c.useState)(null),x=Object(o.a)(v,2),p=x[0],S=x[1],g=Object(c.useState)(),m=Object(o.a)(g,2),y=m[0],k=m[1],D=Object(c.useState)([]),E=Object(o.a)(D,2),N=E[0],R=E[1],T=Object(c.useState)(d.ADD),A=Object(o.a)(T,2),P=A[0],M=A[1];Object(c.useEffect)((function(){if(n){var e=URL.createObjectURL(n);h(e)}}),[n]);var U=function(e){N.map((function(e){return e.isSelected=!1})),e>=0&&e<N.length&&(N[e].isSelected=!0),R(Object(l.a)(N))},X=function(e){var t=N.filter((function(t){var n,c=Object(u.a)(e);try{for(c.s();!(n=c.n()).done;){var r=n.value;if(t.id===r.id)return!1}}catch(i){c.e(i)}finally{c.f()}return!0}));R([].concat(Object(l.a)(e),Object(l.a)(t)))};return Object(s.jsxs)("div",{className:"App",children:[Object(s.jsx)(C,{img:p,quads:N,newQuad:function(e){return R([e].concat(Object(l.a)(N)))},tool:P,setSelected:U,moveSelected:function(e){var t=N.filter((function(e){return e.isSelected}));t.map((function(t){var n,c=Object(u.a)(t.shape);try{for(c.s();!(n=c.n()).done;){var r=n.value;r[0]+=e[0],r[1]+=e[1]}}catch(i){c.e(i)}finally{c.f()}})),X(t)},deleteSelected:function(){var e=N.filter((function(e){return!e.isSelected}));R(e)},slider:y}),Object(s.jsx)(j,{source:b,setVideo:S,setSlider:k,value:null!==y&&void 0!==y?y:0}),Object(s.jsx)(f,{setFile:r,accept_types:"video/*"}),Object(s.jsx)(O,{value:P,onAdd:function(){M(d.ADD),U(-1)},onSelect:function(){M(d.SELECT),U(-1)}}),Object(s.jsx)(w,{target:N}),Object(s.jsx)(L,{target:N,source:null===n||void 0===n?void 0:n.name})]})}var R=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,26)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,i=t.getLCP,a=t.getTTFB;n(e),c(e),r(e),i(e),a(e)}))};a.a.render(Object(s.jsx)(r.a.StrictMode,{children:Object(s.jsx)(N,{})}),document.getElementById("root")),R()}],[[25,1,2]]]);
//# sourceMappingURL=main.588b6c3b.chunk.js.map